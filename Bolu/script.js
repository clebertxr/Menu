const products = [
    {
        "id": 1,
        "name": "Cenoura com chocolate",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 25.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de cenoura/1.jpg"
        ]
    },
    {
        "id": 2,
        "name": "Cenoura com brigadeiro",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 25.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de cenoura com brigadeiro/1.jpg"
        ]
    },
    {
        "id": 3,
        "name": "Cenoura formigueiro",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 20.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 4,
        "name": "Cenoura mesclado com chocolate",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 22.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de chocolate mesclado/1.jpg"
        ]
    },
    {
        "id": 5,
        "name": "Milho com coco e leite condensado",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 28.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 6,
        "name": "Vulcãozinho de bicho de pé",
        "description": "Bolo médio caseiro com cobertura generosa de bicho de pé.",
        "price": 26.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 7,
        "name": "Vulcãozinho de chocolate com brigadeiro",
        "description": "Bolo médio caseiro com cobertura vulcão de brigadeiro.",
        "price": 30.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Vulcaozinho de brigadeiro/1.jpg"
        ]
    },
    {
        "id": 8,
        "name": "Cuca de maçã",
        "description": "Bolo médio caseiro tipo cuca de maçã, 6 a 8 fatias.",
        "price": 21.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Cuca de maçã/1.jpg"
        ]
    },
    {
        "id": 9,
        "name": "Cuca de banana",
        "description": "Bolo médio caseiro tipo cuca de banana, 6 a 8 fatias.",
        "price": 22.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 10,
        "name": "Mesclado chocolate e pão de ló",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 22.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo mesclado de pão de ló e chocolate/2.jpg"
        ]
    },
    {
        "id": 11,
        "name": "Mesclado de café com chocolate",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 25.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Café com chocolate/1.jpg"
        ]
    },
    {
        "id": 12,
        "name": "Fubá com goiabada",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 20.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Fubá com goiabada/1.jpg"
        ]
    },
    {
        "id": 13,
        "name": "Choco whey",
        "description": "Bolo médio caseiro fitness com whey, serve de 6 a 8 fatias.",
        "price": 45.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 14,
        "name": "Laranja com gotas de chocolate",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 22.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 15,
        "name": "Laranja ou limão com iogurte",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 20.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de laranja/1.jpg"
        ]
    },
    {
        "id": 16,
        "name": "Limão com iogurte e leite condensado",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 25.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de limão com iogurte/1.jpg",
            "/Bolu/img/Bolo de limão com iogurte/2.jpg"
        ]
    },
    {
        "id": 17,
        "name": "Limão com brigadeiro de cidreira",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 25.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de limão com brigadeiro e cidreira/1.jpg"
        ]
    },
    {
        "id": 18,
        "name": "Formigueiro",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 20.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Formigueiro/1.jpg"
        ]
    },
    {
        "id": 19,
        "name": "Chocolate Simples",
        "description": "Bolo médio caseiro, serve de 6 a 8 fatias.",
        "price": 22.00,
        "category": "Bolos médios",
        images: [
            "/Bolu/img/Bolo de chocolate/1.jpg"
        ]
    },
    {
        "id": 20,
        "name": "Piscininha de Paçoca",
        "description": "Bolo piscina médio, serve de 6 a 8 pedaços, com cobertura de paçoca.",
        "price": 25.00,
        "category": "Piscina média",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 21,
        "name": "Piscininha Sensação brigadeiro de morango",
        "description": "Bolo piscina médio, serve de 6 a 8 pedaços, sabor sensação.",
        "price": 30.00,
        "category": "Piscina média",
        images: [
            "/Bolu/img/Piscina de sensação de morango/1.jpg"
        ]
    },
    {
        "id": 22,
        "name": "Piscininha de Churros",
        "description": "Bolo piscina médio, serve de 6 a 8 pedaços, sabor churros e doce de leite.",
        "price": 28.00,
        "category": "Piscina média",
        images: [
            "/Bolu/img/Piscina de churros/1.jpeg"
        ]
    },
    {
        "id": 23,
        "name": "Piscininha de Prestígio",
        "description": "Bolo piscina médio, serve de 6 a 8 pedaços, sabor prestígio.",
        "price": 30.00,
        "category": "Piscina média",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 24,
        "name": "Piscininha de Ninho com morango",
        "description": "Bolo piscina médio, serve de 6 a 8 pedaços, com ninho e morango.",
        "price": 35.00,
        "category": "Piscina média",
        images: [
            "/Bolu/img/Bolo de ninho com morango/1.jpg"
        ]
    },
    {
        "id": 25,
        "name": "Piscina de chocolate com brigadeiro",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, puro chocolate.",
        "price": 45.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 26,
        "name": "Piscina de bicho de pé",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, cobertura rosa de bicho de pé.",
        "price": 30.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/Piscina de bicho de pé/1.jpg",
            "/Bolu/img/Piscina de bicho de pé/2.jpg"
        ]
    },
    {
        "id": 27,
        "name": "Piscina de milho com goiabada",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, sabor clássico de milho com goiabada.",
        "price": 28.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/Piscina de milho com goiabada/1.jpg"
        ]
    },
    {
        "id": 28,
        "name": "Piscina de cenoura com chocolate",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, cenoura com chocolate.",
        "price": 28.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png",
            "/Bolu/img/sem foto.png"
        ]
    },
    {
        "id": 29,
        "name": "Piscina de morango com ninho",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, morango fresco e creme de ninho.",
        "price": 40.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/Piscina de brigadeiro e ninho com morango/1.jpg"
        ]
    },
    {
        "id": 30,
        "name": "Piscina de brigadeiro e ninho com morango",
        "description": "Bolo piscina grande, serve de 10 a 12 pedaços, combinação especial de brigadeiro, ninho e morango.",
        "price": 45.00,
        "category": "Piscina grande",
        images: [
            "/Bolu/img/piscina de brigadeiro com morangos/1.jpg",
            "/Bolu/img/Piscina de brigadeiro/1.jpg"
        ]
    }
];

let cart = [];
let currentDetailId = null;
let detailQuantity = 1;
let activeCategory = 'Todos';

document.addEventListener('DOMContentLoaded', () => {
    renderCategories();
    renderProducts();
    lucide.createIcons();
});

// --- Filtro ---
function renderCategories() {
    const categories = ['Todos', ...new Set(products.map(p => p.category))];
    const container = document.getElementById('category-filters');

    container.innerHTML = categories.map(cat => `
                <button 
                    onclick="filterByCategory('${cat}')"
                    class="category-btn px-4 py-2 rounded-full text-sm font-medium border transition-colors duration-200 
                    ${activeCategory === cat ? 'active' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}"
                >
                    ${cat}
                </button>
            `).join('');
}

function filterByCategory(category) {
    activeCategory = category;
    renderCategories();
    renderProducts();
}

// --- Produtos ---
function renderProducts() {
    const grid = document.getElementById('products-grid');
    const filteredProducts = activeCategory === 'Todos'
        ? products
        : products.filter(p => p.category === activeCategory);

    if (filteredProducts.length === 0) {
        grid.innerHTML = `
                    <div class="col-span-full text-center py-10">
                        <p class="text-gray-500 text-lg">Nenhum produto encontrado nesta categoria.</p>
                    </div>
                `;
    } else {
        grid.innerHTML = filteredProducts.map(product => `
                    <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 flex flex-col group animate-in fade-in">
                        <div class="relative h-48 overflow-hidden cursor-pointer" onclick="openProductDetails(${product.id})">
                            <img src="${product.images[0]}" alt="${product.name}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500">
                            <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-semibold text-gray-700 shadow-sm">
                                ${product.category}
                            </div>
                        </div>
                        
                        <div class="p-5 flex-1 flex flex-col">
                            <div class="flex justify-between items-start mb-2 cursor-pointer" onclick="openProductDetails(${product.id})">
                                <h3 class="text-lg font-bold text-gray-900 leading-tight hover:text-red-600 transition-colors">${product.name}</h3>
                                <span class="text-lg font-bold text-red-600 whitespace-nowrap ml-2">R$ ${product.price.toFixed(2)}</span>
                            </div>
                            
                            <p class="text-gray-500 text-sm mb-4 line-clamp-2 flex-1 cursor-pointer" onclick="openProductDetails(${product.id})">${product.description}</p>

                            <button onclick="openProductDetails(${product.id})" class="w-full bg-red-50 text-red-600 py-2.5 px-4 rounded-lg font-semibold hover:bg-red-600 hover:text-white transition-all duration-300 flex items-center justify-center space-x-2">
                                <i data-lucide="plus" class="h-5 w-5"></i>
                                <span>Adicionar</span>
                            </button>
                        </div>
                    </div>
                `).join('');
    }
    lucide.createIcons();
}

// --- Detalhes ---
function openProductDetails(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;

    currentDetailId = id;
    detailQuantity = 1;
    currentSlideIndex = 0;

    updateSlideImage(product);

    document.getElementById('detail-title').innerText = product.name;
    document.getElementById('detail-price').innerText = `R$ ${product.price.toFixed(2)}`;
    document.getElementById('detail-description').innerText = product.description;
    document.getElementById('detail-category').innerText = product.category;
    document.getElementById('detail-quantity').innerText = "1";
    document.getElementById('detail-observation').value = "";

    const btnAdd = document.getElementById('btn-add-detail');
    btnAdd.onclick = () => {
        const obs = document.getElementById('detail-observation').value.trim();
        addToCart(currentDetailId, detailQuantity, obs);
        closeProductDetails();
    };

    document.getElementById('product-detail-modal').classList.remove('hidden');
    lucide.createIcons();
}

function changeSlide(direction) {
    const product = products.find(p => p.id === currentDetailId);
    if (!product || !product.images) return;

    currentSlideIndex += direction;

    if (currentSlideIndex >= product.images.length) {
        currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
        currentSlideIndex = product.images.length - 1;
    }

    updateSlideImage(product);
}

function updateSlideImage(product) {
    const imgElement = document.getElementById('detail-image');
    imgElement.style.opacity = '0.5';

    setTimeout(() => {
        imgElement.src = product.images[currentSlideIndex];
        imgElement.style.opacity = '1';
    }, 150);
}

function closeProductDetails() {
    document.getElementById('product-detail-modal').classList.add('hidden');
}

function adjustDetailQuantity(delta) {
    const newQty = detailQuantity + delta;
    if (newQty >= 1) {
        detailQuantity = newQty;
        document.getElementById('detail-quantity').innerText = detailQuantity;
    }
}

// --- Carrinho ---
function addToCart(productId, quantity, observation) {
    const product = products.find(p => p.id === productId);
    const existingItem = cart.find(item => item.productId === productId && item.observation === observation);

    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        cart.push({
            cartId: Date.now().toString(),
            productId: productId,
            name: product.name,
            price: product.price,
            image: product.images[0],
            category: product.category,
            quantity: quantity,
            observation: observation
        });
    }

    updateCartUI();
    showToast(`Adicionado ao pedido: ${quantity} ${product.name}`);
}

function showToast(message) {
    const toast = document.getElementById('toast');
    toast.innerText = message;
    toast.className = "show";
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

function removeFromCart(cartId) {
    cart = cart.filter(item => item.cartId !== cartId);
    updateCartUI();
}

function updateCartQuantity(cartId, delta) {
    const item = cart.find(item => item.cartId === cartId);
    if (item) {
        const newQty = item.quantity + delta;
        if (newQty > 0) item.quantity = newQty;
    }
    updateCartUI();
}

function toggleCart(show) {
    const modal = document.getElementById('cart-modal');
    if (show) {
        modal.classList.remove('hidden');
        updateCartUI();
    } else {
        modal.classList.add('hidden');
    }
}

function updateCartUI() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const badge = document.getElementById('cart-badge');

    if (totalItems > 0) {
        badge.innerText = totalItems;
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }

    const footer = document.getElementById('cart-footer');
    if (cart.length > 0) {
        footer.classList.remove('hidden');
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2)}`;
    } else {
        footer.classList.add('hidden');
    }

    renderCartItems();
}

function renderCartItems() {
    const container = document.getElementById('cart-content');

    if (cart.length === 0) {
        container.innerHTML = `
                    <div class="h-full flex flex-col items-center justify-center text-center space-y-4">
                        <div class="bg-gray-100 p-6 rounded-full">
                            <i data-lucide="shopping-cart" class="h-12 w-12 text-gray-400"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-900">Seu pedido está vazio</h3>
                            <p class="text-gray-500 mt-1">Adicione alguns itens deliciosos!</p>
                        </div>
                        <button onclick="toggleCart(false)" class="text-red-600 font-semibold hover:text-red-700">
                            Voltar ao Menu
                        </button>
                    </div>
                `;
    } else {
        let html = '<ul class="space-y-4 mb-6">';
        cart.forEach(item => {
            const obsHtml = item.observation
                ? `<div class="mt-1 text-xs text-red-600 bg-red-50 p-1 rounded border border-red-100 italic">
                             <i data-lucide="message-square" class="inline w-3 h-3 mr-1"></i>Obs: ${item.observation}
                           </div>`
                : '';

            html += `
                        <li class="flex py-2 fade-in border-b border-gray-100 pb-4 last:border-0">
                            <div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200">
                                <img src="${item.image}" alt="${item.name}" class="h-full w-full object-cover object-center">
                            </div>
                            <div class="ml-4 flex flex-1 flex-col">
                                <div>
                                    <div class="flex justify-between text-base font-medium text-gray-900">
                                        <h3>${item.name}</h3>
                                        <p class="ml-4">R$ ${(item.price * item.quantity).toFixed(2)}</p>
                                    </div>
                                    <p class="mt-1 text-sm text-gray-500">${item.category}</p>
                                    ${obsHtml}
                                </div>
                                <div class="flex flex-1 items-end justify-between text-sm mt-2">
                                    <div class="flex items-center border border-gray-300 rounded-lg">
                                        <button onclick="updateCartQuantity('${item.cartId}', -1)" class="p-1 hover:bg-gray-100 rounded-l-lg transition-colors"><i data-lucide="minus" class="h-4 w-4 text-gray-600"></i></button>
                                        <span class="px-3 font-medium text-gray-900">${item.quantity}</span>
                                        <button onclick="updateCartQuantity('${item.cartId}', 1)" class="p-1 hover:bg-gray-100 rounded-r-lg transition-colors"><i data-lucide="plus" class="h-4 w-4 text-gray-600"></i></button>
                                    </div>
                                    <button onclick="removeFromCart('${item.cartId}')" class="font-medium text-red-500 hover:text-red-700 flex items-center space-x-1 transition-colors">
                                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                                        <span>Remover</span>
                                    </button>
                                </div>
                            </div>
                        </li>
                    `;
        });
        html += '</ul>';
        container.innerHTML = html;
    }
    lucide.createIcons();
}

function checkout() {
    const phoneNumber = "5511964064041";
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    let message = "*NOVA ENCOMENDA*\n\n*Itens do Pedido:*\n";

    cart.forEach(item => {
        message += `• ${item.quantity}x ${item.name} - R$ ${(item.price * item.quantity).toFixed(2)}\n`;
        if (item.observation)
            message += `   _Obs: ${item.observation}_\n`;
    });

    message += `\n*Total: R$ ${total.toFixed(2)}*`;
    message += "\n\n----------------------------\nQuero confirmar o pedido!";

    window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank');
}